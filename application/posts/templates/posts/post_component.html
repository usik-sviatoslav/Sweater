{% load static %}

  <!-- start "profile_img - username - created at - advanced" block -->
  <div class="d-flex flex-row">
    <a href="{% url 'profile' post.user.username %}" class="btn btn-bd-light p-1 me-2">
      <img src="{% if post.user.profile_image %} {{ post.user.profile_image.url }} {% else %} {% static 'images/avatar.svg' %} {% endif %}" alt="user" width="44" height="44" class="object-fit-cover rounded-circle bd-border" style="image-rendering: smooth">
    </a>

    <div class="d-flex flex-row align-items-center" style="width: 472px">
      <a href="{% url 'profile' post.user.username %}" class="text-decoration-none link-body-emphasis">
        <span class="m-0 fw-medium" style="font-size: 19px;">{{post.user.username}}</span>
      </a>


      <div class="d-flex flex-row align-items-center ms-auto">
        <span style="font-size: 15px; color: rgba(64,64,64,0.75);" class="created_at me-1" data-post-created="{{ post.created_at|date:'c' }}"></span>

        {% if request.user.is_authenticated %}
          <div class="dropstart">

            <button class="btn btn-bd-light d-flex justify-content-center align-items-center p-2" data-bs-toggle="dropdown" aria-expanded="false">
              <img src="{% static 'images/three-dots-vertical.svg' %}" alt="three-dots" width="18" height="18">
            </button>

            <ul class="dropdown-menu btn-bd-light shadow-sm py-0 px-0 border-1" style="border-radius: 20px;">
              {% if request.user == post.user %}
              <li><a class="btn mx-0 px-0 my-0 d-flex justify-content-center border-0" style="border-radius: 19px 19px 0 0; font-size: 16px" href="{% url 'edit_post' post.id %}">Редагувати пост</a></li>
              <li><hr class="dropdown-divider my-0"></li>
              <li><a class="btn mx-0 px-0 my-0 d-flex justify-content-center border-0" style="border-radius: 0 0 19px 19px; color: red; font-size: 16px" href="{% url 'remove_post' post.id %}">Видалити пост</a></li>
              {% else %}
                {% if request.user not in post.user.subscribers.all %}
                <li><button class="btn mx-0 px-0 my-0 d-flex justify-content-center border-0 w-100 subscribe-button" style="border-radius: 19px 19px 0 0; font-size: 16px" data-user="{{ post.user.username }}" data-user-auth="{{ request.user.is_authenticated }}"><span>Підписатись</span></button></li>
                {% else %}
                <li><button class="btn mx-0 px-0 my-0 d-flex justify-content-center border-0 w-100 unsubscribe-button" style="border-radius: 19px 19px 0 0; font-size: 16px" data-user="{{ post.user.username }}" data-user-auth="{{ request.user.is_authenticated }}"><span>Відписатись</span></button></li>
                {% endif %}
              <li><hr class="dropdown-divider my-0"></li>
              <li><a class="btn mx-0 px-0 my-0 d-flex justify-content-center border-0" style="border-radius: 0 0 19px 19px; color: red; font-size: 16px" href="#{% url 'report_on_post' post.id %}">Поскаржитись</a></li>
              {% endif %}
            </ul>

          </div>
        {% endif %}

      </div>

    </div>
  </div>
  <!-- end "profile_img - username - created at - advanced" block -->

  <!-- start "content" block -->
  <div class="me-auto my-2" style="width: 533px">
    {% if post.content %}
    <p class="text-wrap mb-0" style="font-size: 16px; user-select: text">{{ post.content }}</p>
    {% endif %}
  </div>
  <!-- end "content" block -->

  <!-- start "file" block -->
  <picture>
    {% if post.file %}
    <img src="{{ post.file.url }}" alt="user" class="object-fit-cover shadow-sm bd-border" style="max-width: 410px; max-height: 472px">
    {% endif %}
  </picture>
  <!-- end "file" block -->

  <!-- start "buttons" block -->
  <div class="d-flex align-content-center my-2">
    <button class="like-post btn btn-bd-light d-flex justify-content-center align-items-center p-2" data-post-id="{{ post.id }}" data-user="{{ request.user.is_authenticated }}">
      {% if post.id in like_post_by_user %}
        <img src="{% static 'images/heart-fill.svg' %}" alt="heart" class="bi pe-none" width="25" height="25">
      {% else %}
        <img src="{% static 'images/heart.svg' %}" alt="heart" class="bi pe-none" width="25" height="25">
      {% endif %}
    </button>

    <!-- Button trigger modal -->
    <button class="btn btn-bd-light d-flex justify-content-center align-items-center p-2" data-bs-toggle="modal" data-bs-target="#post-№{{ post.id }}">
      <img src="{% static 'images/chat.svg' %}" alt="chat" class="bi pe-none" width="25" height="25">
    </button>

    <!-- Modal -->
    <div class="modal fade" id="post-№{{ post.id }}" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" style="margin-left: 398px">
        <div class="modal-content shadow bd-border" style="border-radius: 20px">

          <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabel">Додати коментар</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <div class="modal-body">
            <form action="{% url 'reply_on_post' post.id %}" method="POST">
              {% csrf_token %}
              {% for field in forms %}
                {{ field }}
              {% endfor%}

              <div class="modal-footer">
                <button class="btn btn-success">Опублікувати</button>
              </div>

            </form>
          </div>
        </div>
      </div>
    </div>


    <a href="#/share" class="btn btn-bd-light d-flex justify-content-center align-items-center p-2">
      <img src="{% static 'images/send.svg' %}" alt="send" class="bi pe-none" width="25" height="25">
    </a>
  </div>
  <!-- end "buttons" block -->

  <!-- start "info_for_post" block -->
  <div class="comments-and-likes-block" data-post-id="{{ post.id }}" {% if post.comments_count == 0 and post.likes.count == 0 %} style="display: none;" {% endif %}>
    <div class="d-flex flex-row align-items-center mb-2" style="font-size: 15px;">

      <a href="{% url 'view_post' post.id %}" class="text-decoration-none link-body-emphasis post-comments-count" data-post-id="{{ post.id }}">
        {% if post.comments_count > 0 %}
        <span>{% if post.comments.count > 1 %}{{ post.comments_count }} відповідей {% else %} Одна відповідь {% endif %}</span>
        {% endif %}
      </a>

      <span class="mx-2 info-dot" data-post-id="{{ post.id }}"{% if post.comments_count == 0 or post.likes.count == 0 %} style="display: none;" {% endif %}>·</span>

      <a href="#/show-who-liked" class="text-decoration-none link-body-emphasis post-likes-count" data-post-id="{{ post.id }}">
        {% if post.likes.count > 0 %}
          <span>{% if post.likes.count > 1 %}{{ post.likes.count }} позначок "Подобається" {% else %} Одна позначка "Подобається" {% endif %}</span>
        {% endif %}
      </a>

    </div>
  </div>
  <!-- end "info_for_post" block -->