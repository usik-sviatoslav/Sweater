{% load static %}

{% block content %}

<div class="d-flex flex-column" style="user-select: none">
  <div class="mt-4 d-flex justify-content-center">
    <div class="d-flex flex-column">
      
      <div class="d-flex flex-row">

          <!-- start "profile_img - vertical line" block -->
          <div class="d-flex flex-column me-2">
            <a href="{% url 'profile' comment.user.username %}" class="btn btn-bd-light p-1">
              <img src="{% if comment.user.profile_image %} {{ comment.user.profile_image.url }} {% else %} {% static 'images/avatar.svg' %} {% endif %}" alt="user" width="44" height="44" class="object-fit-cover rounded-circle bd-border" style="image-rendering: smooth">
            </a>

            <div class="d-flex justify-content-center my-3" style="height: 100%;">
              <div class="vl" data-post-id="{{ comment.id }}"{% if comment.comments_count == 0 %} style="display: none;" {% endif %}></div>
            </div>
          </div>
          <!-- end "profile_img - vertical line" block -->

          <div style="width: 100%">

            <!-- start "username - created at - advanced" block -->
            <div class="d-flex flex-row align-items-center" style="width: 472px">
              <a href="{% url 'profile' comment.user.username %}" class="text-decoration-none link-body-emphasis">
                <span class="m-0 fw-medium" style="font-size: 19px;">{{comment.user.username}}</span>
              </a>
              <div class="d-flex flex-row align-items-center ms-auto">
                <span style="font-size: 15px; color: rgba(64,64,64,0.75);" class="created_at me-1" data-post-created="{{ comment.created_at|date:'c' }}"></span>
                <a href="#/advanced" class="btn btn-bd-light d-flex justify-content-center align-items-center px-2 py-2">
                  <img src="{% static 'images/three-dots-vertical.svg' %}" alt="three-dots" width="18" height="18">
                </a>
              </div>
            </div>
            <!-- end "username - created at - advanced" block -->

            <!-- start "content" block -->
            <div class="me-auto mb-2" style="width: 472px; padding-right: 36px">
              {% if comment.content %}
              <p class="text-wrap mb-0" style="font-size: 16px; user-select: text">{{ comment.content }}</p>
              {% endif %}
            </div>
            <!-- end "content" block -->

            <!-- start "file" block -->
            <picture>
              {% if comment.file %}
              <img src="{{ comment.file.url }}" alt="user" class="object-fit-cover shadow-sm bd-border" style="max-width: 410px; max-height: 472px">
              {% endif %}
            </picture>
            <!-- end "file" block -->

            <!-- start "buttons" block -->
            <div class="d-flex align-content-center my-2">
              <button class="like-comment btn btn-bd-light d-flex justify-content-center align-items-center p-2" data-post-id="{{ post.id }}" data-comment-id="{{ comment.id }}" data-user="{{ request.user.is_authenticated }}">
                {% if comment.id in like_comment_by_user %}
                  <img src="{% static 'images/heart-fill.svg' %}" alt="heart" class="bi pe-none" width="20" height="20">
                {% else %}
                  <img src="{% static 'images/heart.svg' %}" alt="heart" class="bi pe-none" width="20" height="20">
                {% endif %}
              </button>

              <!-- Button trigger modal -->
              <button class="btn btn-bd-light d-flex justify-content-center align-items-center p-2" data-bs-toggle="modal" data-bs-target="#comment-№{{ comment.id }}">
                <img src="{% static 'images/chat.svg' %}" alt="chat" class="bi pe-none" width="20" height="20">
              </button>

              <!-- Modal -->
              <div class="modal fade" id="comment-№{{ comment.id }}" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" style="margin-left: 398px">
                  <div class="modal-content shadow bd-border" style="border-radius: 20px">

                    <div class="modal-header">
                      <h1 class="modal-title fs-5" id="exampleModalLabel">Додати коментар</h1>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <div class="modal-body">
                      <form action="{% url 'reply_on_comment' post_id=post.id comment_id=comment.id %}" method="POST">
                        {% csrf_token %}
                        {% for field in forms %}
                          {{ field }}
                        {% endfor%}

                        <div class="modal-footer">
                          <button class="btn btn-success">Опублікувати</button>
                        </div>

                      </form>
                    </div>
                  </div>
                </div>
              </div>

              <a href="#/share" class="btn btn-bd-light d-flex justify-content-center align-items-center p-2">
                <img src="{% static 'images/send.svg' %}" alt="send" class="bi pe-none" width="20" height="20">
              </a>
            </div>
            <!-- end "buttons" block -->

          </div>
        </div>

    
      {% for comment in parent_comments %}
        <div class="d-flex flex-row">

          <!-- start "profile_img - vertical line" block -->
          <div class="d-flex flex-column me-2">
            <a href="{% url 'profile' comment.user.username %}" class="btn btn-bd-light p-1">
              <div style="width: 44px">
                <img src="{% if comment.user.profile_image %} {{ comment.user.profile_image.url }} {% else %} {% static 'images/avatar.svg' %} {% endif %}" alt="user" width="30" height="30" class="object-fit-cover rounded-circle bd-border" style="image-rendering: smooth">
              </div>
            </a>

            <div class="d-flex justify-content-center my-3" style="height: 100%;">
              <div class="vl" data-comment-id="{{ comment.id }}"{% if comment.comments_count == 0 or forloop.last %} style="display: none;" {% endif %}></div>
            </div>
          </div>
          <!-- end "profile_img - vertical line" block -->

          <div style="width: 100%">

            <!-- start "username - created at - advanced" block -->
            <div class="d-flex flex-row align-items-center" style="width: 100%">
              <a href="{% url 'profile' comment.user.username %}" class="text-decoration-none link-body-emphasis">
                <span class="m-0 fw-normal" style="font-size: 19px;">{{ comment.user.username }}</span>
              </a>
              <div class="d-flex flex-row align-items-center ms-auto">
                <span style="font-size: 15px; color: rgba(64,64,64,0.75);" class="created_at me-1" data-post-created="{{ comment.created_at|date:'c' }}"></span>
                <a href="#/advanced" class="btn btn-bd-light d-flex justify-content-center align-items-center p-2">
                  <img src="{% static 'images/three-dots-vertical.svg' %}" alt="three-dots" width="18" height="18">
                </a>
              </div>
            </div>
            <!-- end "username - created at - advanced" block -->

            <!-- start "content" block -->
            <div class="me-auto mb-2" style="width: 472px; padding-right: 36px">
              {% if comment.content %}
              <p class="text-wrap mb-0" style="font-size: 16px; user-select: text">{{ comment.content }}</p>
              {% endif %}
            </div>
            <!-- end "content" block -->

            <!-- start "file" block -->
            <picture>
              {% if comment.file %}
              <img src="{{ comment.file.url }}" alt="user" class="object-fit-cover shadow-sm bd-border" style="max-width: 410px; max-height: 472px">
              {% endif %}
            </picture>
            <!-- end "file" block -->

            <!-- start "buttons" block -->
            <div class="d-flex align-content-center my-2">
              <button class="like-comment btn btn-bd-light d-flex justify-content-center align-items-center p-2" data-post-id="{{ post.id }}" data-comment-id="{{ comment.id }}" data-user="{{ request.user.is_authenticated }}">
                {% if comment.id in like_comment_by_user %}
                  <img src="{% static 'images/heart-fill.svg' %}" alt="heart" class="bi pe-none" width="20" height="20">
                {% else %}
                  <img src="{% static 'images/heart.svg' %}" alt="heart" class="bi pe-none" width="20" height="20">
                {% endif %}
              </button>

              <a href="#/add-comment" class="btn btn-bd-light d-flex justify-content-center align-items-center p-2">
                <img src="{% static 'images/chat.svg' %}" alt="chat" class="bi pe-none" width="20" height="20">
              </a>

              <a href="#/share" class="btn btn-bd-light d-flex justify-content-center align-items-center p-2">
                <img src="{% static 'images/send.svg' %}" alt="send" class="bi pe-none" width="20" height="20">
              </a>
            </div>
            <!-- end "buttons" block -->

          </div>
        </div>
      {% endfor %}
      
    </div>
  </div>
</div>

{% if forloop.last %}
{% else %}
<div class="mb-4"></div>
{% endif %}

{% endblock content %}